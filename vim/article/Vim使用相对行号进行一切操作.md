# Vim使用相对行号进行一切操作

 时间 2017-11-15 20:29:30  

原文[https://www.kawabangga.com/posts/2287][1]


使用Vim的一点好处就是，可定制性非常高，如果遇到任何让自己感到不适的痛点，都可以通过配置甚至开发一款插件来解决。开始使用Vim一段时间之后，我发现一个非常“反人类”的地方：Vim的很多命令都是需要查行数的。比如“删除一个函数体”，你就要数数这个函数占了几行（比如5行），然后按 `5dd` 。如果是使用鼠标的话就不用数了，可以直接拖过去，但是鼠标效率太低，既然学了Vim就不要让手离开键盘了。我总结了一套方案，几乎所有的操作都可以不用数数来完成。 

Vim支持两种行号，相对行号和绝对行号。相对行号是显示每一行距离光标所在行 **相隔** 多少行，绝对行号就是顺序显示每一行的序号。 

`set nu` 打开行号显示， `set rnu` 打开相对行号显示（更多信息可以查看 `:help nu` 和 `:help rnu` 。效果如下： 

![][3]

打开行号显示

![][4]

打开相对行号的显示

![][5]

同时打开相对行号和绝对行号

可以看到，如果同时打开二者，就会在当前行显示绝对行号，其他显示距离当前行的距离。

使用一段时间我发现，在normal模式时，经常进行对多行的操作，这时候如果使用绝对行号，那么必然是要做减法，或者去数数来确定行的数量的。所以在normal模式应该使用相对行号。0对我们来说是没有任何作用的，所以当前行还是显示行号吧。然后一些常用的操作习惯都要相应换一下：

* 删除n行。 `3dd` 是删除包括当前行一共3行，但是因为显示的是相对行号，我们要“删除直到目标行”的时候，要不自觉的`+1`，比如在上面最后一幅图，要删除直到“终端配色安装”的内容，就要按 `4dd` 。有没有办法不用计算，所见即所得呢？有的， `d3j` 即可。command+直到目标行号`+`方向。例如删除直到上面“我对……”的内容，就是 `d4k` 。
* 其余的操作也是类似，例如移动到下面4行，可以用 `4gg` ，也可以用 `g4j` 。其他还有yank操作等。
* 替换范围本来是使用绝对行号就可以，例如替换10-20行，就是 `:10,20s/xxx/yyy/g` ，但是由于我们normal模式显示了相对行号，那么就要根据相对行号操作了： `:.+2,.+12s/xxx/yyy/g` (假设当前在第8行）。 `.` 在Vim中表示当前行，要善于利用。由于我们显示的是相对行号，所以基本上和行号有关的操作都需要计算完成，用 `.` 加上`/`减去显示的相对行号（所见即所得）

在insert模式时，我们一般都是编辑操作，不会对多行进行判断，此时可能对绝对行号更关心（写到多少行了等）。所以可以监听一下事件，进入编辑模式时使用绝对行号，退出编辑模式进入normal模式时使用相对行号。设置如下：

    set nu
    augroup relative_numbser
        autocmd!
        autocmd InsertEnter * :set norelativenumber
        autocmd InsertLeave * :set relativenumber
    augroup END
    

 `set nu` 是因为我一般打开一个文件不一定是编辑目的，浏览的话绝对行号更方便。这样设置可以让第一次进入文件的时候使用绝对行号，进入编辑模式再退出到normal模式时再显示相对行号。 

这样用了一段时间，感觉按下的键多了，但是脑子里需要的计算少了很多，还不容易出错，挺好的。

最后附上 [我的 .vimrc][6] ，供参考使用，不推荐盲目复制。


[1]: https://www.kawabangga.com/posts/2287

[3]: ../img/RBVZNrV.png
[4]: ../img/F3qEjeu.png
[5]: ../img/QzUZneR.png
[6]: https://github.com/laixintao/myrc/blob/master/.vimrc